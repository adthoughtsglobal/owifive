<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebOS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #0078d4;
            --secondary-color: #f3f2f1;
            --accent-color: #0063b1;
            --text-color: #323130;
            --bg-color: #faf9f8;
            --window-bg: #ffffff;
            --border-color: #e1dfdd;
            --shadow: 0 4px 8px rgba(0,0,0,0.1);
            --wallpaper: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        body, html {
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
            background: var(--wallpaper);
        }

        /* Login Screen */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--wallpaper);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 40px;
            box-shadow: var(--shadow);
            text-align: center;
            min-width: 350px;
        }

        .login-card h1 {
            margin-bottom: 30px;
            color: var(--text-color);
        }

        .login-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            font-size: 16px;
        }

        .login-btn {
            width: 100%;
            padding: 12px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
        }

        .login-btn:hover {
            background: var(--accent-color);
        }

        /* Desktop */
        .desktop {
            position: relative;
            width: 100%;
            height: 100vh;
            background: var(--wallpaper);
        }

        /* Taskbar */
        .taskbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 48px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-top: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            padding: 0 16px;
            z-index: 1000;
        }

        .start-button {
            width: 40px;
            height: 40px;
            background: var(--primary-color);
            border: none;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            margin-right: 16px;
            font-size: 18px;
        }

        .dock {
            display: flex;
            gap: 8px;
            flex: 1;
        }

        .dock-item {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-size: 18px;
        }

        .dock-item:hover {
            transform: scale(1.1);
            background: white;
        }

        .dock-item.active {
            background: var(--primary-color);
            color: white;
        }

        .system-tray {
            display: flex;
            gap: 16px;
            align-items: center;
            color: var(--text-color);
            font-size: 14px;
        }

        /* Windows */
        .window {
            position: absolute;
            background: var(--window-bg);
            border-radius: 8px;
            box-shadow: var(--shadow);
            min-width: 400px;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            z-index: 100;
        }

        .window.maximized {
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: calc(100vh - 48px) !important;
            border-radius: 0;
        }

        .window-header {
            height: 32px;
            background: var(--secondary-color);
            border-radius: 8px 8px 0 0;
            display: flex;
            align-items: center;
            padding: 0 12px;
            cursor: move;
            user-select: none;
        }

        .window-title {
            flex: 1;
            font-size: 14px;
            font-weight: 500;
        }

        .window-controls {
            display: flex;
            gap: 8px;
        }

        .window-control {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            cursor: pointer;
        }

        .control-minimize { background: #ffbd2e; }
        .control-maximize { background: #28ca42; }
        .control-close { background: #ff5f56; }

        .window-content {
            flex: 1;
            padding: 16px;
            overflow: auto;
        }

        /* Start Menu */
        .start-menu {
            position: fixed;
            bottom: 56px;
            left: 16px;
            width: 320px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 8px;
            box-shadow: var(--shadow);
            display: none;
            z-index: 2000;
        }

        .start-menu.active {
            display: block;
        }

        .start-menu-header {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .start-menu-apps {
            padding: 8px;
            max-height: 400px;
            overflow-y: auto;
        }

        .start-menu-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .start-menu-item:hover {
            background: var(--secondary-color);
        }

        .start-menu-icon {
            width: 32px;
            height: 32px;
            margin-right: 12px;
            background: var(--primary-color);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        /* Widgets */
        .widgets-panel {
            position: fixed;
            right: 16px;
            top: 16px;
            width: 300px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            box-shadow: var(--shadow);
            padding: 16px;
            display: none;
        }

        .widget {
            background: white;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .widget h3 {
            margin-bottom: 12px;
            color: var(--text-color);
        }

        /* File Manager */
        .file-manager {
            display: flex;
            height: 100%;
        }

        .file-sidebar {
            width: 200px;
            background: var(--secondary-color);
            border-right: 1px solid var(--border-color);
            padding: 16px;
        }

        .file-content {
            flex: 1;
            padding: 16px;
        }

        .file-toolbar {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }

        .file-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 16px;
        }

        .file-item {
            text-align: center;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .file-item:hover {
            background: var(--secondary-color);
        }

        .file-icon {
            width: 48px;
            height: 48px;
            background: var(--primary-color);
            border-radius: 8px;
            margin: 0 auto 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
        }

        /* Settings */
        .settings-nav {
            width: 200px;
            background: var(--secondary-color);
            border-right: 1px solid var(--border-color);
            padding: 16px;
        }

        .settings-content {
            flex: 1;
            padding: 16px;
        }

        .settings-section {
            margin-bottom: 24px;
        }

        .settings-section h3 {
            margin-bottom: 12px;
            color: var(--text-color);
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }

        /* Utilities */
        .hidden { display: none !important; }
        .no-select { user-select: none; }

        /* Responsive */
        @media (max-width: 768px) {
            .window {
                width: 100% !important;
                height: calc(100vh - 48px) !important;
                top: 0 !important;
                left: 0 !important;
                border-radius: 0;
            }
            
            .widgets-panel {
                width: calc(100% - 32px);
                right: 16px;
                left: 16px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-card">
            <h1>WebOS</h1>
            <input type="text" class="login-input" id="username" placeholder="Username" value="admin">
            <input type="password" class="login-input" id="password" placeholder="Password" value="admin">
            <button class="login-btn" onclick="login()">Sign In</button>
        </div>
    </div>

    <!-- Desktop -->
    <div class="desktop hidden" id="desktop">
        <!-- Widgets Panel -->
        <div class="widgets-panel" id="widgetsPanel">
            <div class="widget">
                <h3>Clock</h3>
                <div id="clockWidget" style="font-size: 24px; text-align: center;"></div>
            </div>
            <div class="widget">
                <h3>Weather</h3>
                <div>Sunny, 22°C</div>
            </div>
            <div class="widget">
                <h3>System Info</h3>
                <div>CPU: 45%<br>RAM: 2.1GB/8GB<br>Storage: 512GB</div>
            </div>
        </div>

        <!-- Start Menu -->
        <div class="start-menu" id="startMenu">
            <div class="start-menu-header">
                <h3>Applications</h3>
            </div>
            <div class="start-menu-apps">
                <div class="start-menu-item" onclick="openApp('fileManager')">
                    <div class="start-menu-icon">📁</div>
                    <div>
                        <div>File Manager</div>
                        <small>Browse and manage files</small>
                    </div>
                </div>
                <div class="start-menu-item" onclick="openApp('textEditor')">
                    <div class="start-menu-icon">📝</div>
                    <div>
                        <div>Text Editor</div>
                        <small>Create and edit documents</small>
                    </div>
                </div>
                <div class="start-menu-item" onclick="openApp('calculator')">
                    <div class="start-menu-icon">🧮</div>
                    <div>
                        <div>Calculator</div>
                        <small>Perform calculations</small>
                    </div>
                </div>
                <div class="start-menu-item" onclick="openApp('settings')">
                    <div class="start-menu-icon">⚙️</div>
                    <div>
                        <div>Settings</div>
                        <small>System configuration</small>
                    </div>
                </div>
                <div class="start-menu-item" onclick="openApp('terminal')">
                    <div class="start-menu-icon">⌨️</div>
                    <div>
                        <div>Terminal</div>
                        <small>Command line interface</small>
                    </div>
                </div>
                <div class="start-menu-item" onclick="openApp('browser')">
                    <div class="start-menu-icon">🌐</div>
                    <div>
                        <div>Web Browser</div>
                        <small>Browse the internet</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Taskbar -->
        <div class="taskbar">
            <button class="start-button" onclick="toggleStartMenu()">⊞</button>
            <div class="dock" id="dock">
                <div class="dock-item" onclick="openApp('fileManager')" title="File Manager">📁</div>
                <div class="dock-item" onclick="openApp('textEditor')" title="Text Editor">📝</div>
                <div class="dock-item" onclick="openApp('calculator')" title="Calculator">🧮</div>
                <div class="dock-item" onclick="openApp('browser')" title="Browser">🌐</div>
            </div>
            <div class="system-tray">
                <span onclick="toggleWidgets()" style="cursor: pointer;">🔧</span>
                <span id="systemTime"></span>
            </div>
        </div>
    </div>

    <script>
        // Global WebOS instance
        let webOS;

        // Global functions for HTML onclick handlers
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (!webOS.login(username, password)) {
                alert('Invalid credentials. Use admin/admin');
            }
        }

        function toggleStartMenu() {
            const startMenu = document.getElementById('startMenu');
            startMenu.classList.toggle('active');
        }

        function toggleWidgets() {
            const widgetsPanel = document.getElementById('widgetsPanel');
            widgetsPanel.style.display = widgetsPanel.style.display === 'none' ? 'block' : 'none';
        }

        function openApp(appName) {
            webOS.openApp(appName);
            // Close start menu if open
            document.getElementById('startMenu').classList.remove('active');
        }

        function closeWindow(windowId) {
            webOS.closeWindow(windowId);
        }

        function minimizeWindow(windowId) {
            webOS.minimizeWindow(windowId);
        }

        function maximizeWindow(windowId) {
            webOS.maximizeWindow(windowId);
        }

        // Core OS System
        class WebOS {
            constructor() {
                this.currentUser = null;
                this.windows = [];
                this.apps = {};
                this.fileSystem = new VirtualFileSystem();
                this.config = {
                    theme: 'default',
                    wallpaper: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                    dockItems: ['fileManager', 'textEditor', 'calculator', 'browser']
                };
                this.init();
            }

            init() {
                this.loadConfig();
                this.initializeApps();
                this.updateClock();
                setInterval(() => this.updateClock(), 1000);
                
                // Initialize drag and drop for windows
                this.initWindowDrag();
            }

            loadConfig() {
                const savedConfig = this.fileSystem.readFile('/system/config.json');
                if (savedConfig) {
                    this.config = { ...this.config, ...JSON.parse(savedConfig) };
                }
                this.applyTheme();
            }

            saveConfig() {
                this.fileSystem.writeFile('/system/config.json', JSON.stringify(this.config));
            }

            applyTheme() {
                document.documentElement.style.setProperty('--wallpaper', this.config.wallpaper);
            }

            updateClock() {
                const now = new Date();
                const timeString = now.toLocaleTimeString();
                const clockWidget = document.getElementById('clockWidget');
                const systemTime = document.getElementById('systemTime');
                
                if (clockWidget) clockWidget.textContent = timeString;
                if (systemTime) systemTime.textContent = timeString;
            }

            login(username, password) {
                // Simple authentication - in a real system, this would be more secure
                if (username === 'admin' && password === 'admin') {
                    this.currentUser = username;
                    document.getElementById('loginScreen').classList.add('hidden');
                    document.getElementById('desktop').classList.remove('hidden');
                    return true;
                }
                return false;
            }

            createWindow(title, content, width = 600, height = 400) {
                const windowId = 'window_' + Date.now();
                const windowElement = document.createElement('div');
                windowElement.className = 'window';
                windowElement.id = windowId;
                windowElement.style.width = width + 'px';
                windowElement.style.height = height + 'px';
                windowElement.style.left = Math.random() * (window.innerWidth - width) + 'px';
                windowElement.style.top = Math.random() * (window.innerHeight - height - 100) + 'px';

                windowElement.innerHTML = `
                    <div class="window-header">
                        <div class="window-title">${title}</div>
                        <div class="window-controls">
                            <div class="window-control control-minimize" onclick="minimizeWindow('${windowId}')"></div>
                            <div class="window-control control-maximize" onclick="maximizeWindow('${windowId}')"></div>
                            <div class="window-control control-close" onclick="closeWindow('${windowId}')"></div>
                        </div>
                    </div>
                    <div class="window-content">
                        ${content}
                    </div>
                `;

                document.getElementById('desktop').appendChild(windowElement);
                this.windows.push(windowId);
                this.bringToFront(windowId);
                return windowId;
            }

            closeWindow(windowId) {
                const window = document.getElementById(windowId);
                if (window) {
                    window.remove();
                    this.windows = this.windows.filter(id => id !== windowId);
                }
            }

            minimizeWindow(windowId) {
                const window = document.getElementById(windowId);
                if (window) {
                    window.style.display = 'none';
                }
            }

            maximizeWindow(windowId) {
                const window = document.getElementById(windowId);
                if (window) {
                    window.classList.toggle('maximized');
                }
            }

            bringToFront(windowId) {
                const window = document.getElementById(windowId);
                if (window) {
                    const maxZ = Math.max(...this.windows.map(id => {
                        const el = document.getElementById(id);
                        return el ? parseInt(el.style.zIndex || 100) : 100;
                    }));
                    window.style.zIndex = maxZ + 1;
                }
            }

            initWindowDrag() {
                document.addEventListener('mousedown', (e) => {
                    if (e.target.classList.contains('window-header')) {
                        const window = e.target.closest('.window');
                        this.dragWindow(window, e);
                    }
                });
            }

            dragWindow(window, startEvent) {
                if (window.classList.contains('maximized')) return;
                
                const startX = startEvent.clientX - window.offsetLeft;
                const startY = startEvent.clientY - window.offsetTop;

                const drag = (e) => {
                    window.style.left = (e.clientX - startX) + 'px';
                    window.style.top = (e.clientY - startY) + 'px';
                };

                const stopDrag = () => {
                    document.removeEventListener('mousemove', drag);
                    document.removeEventListener('mouseup', stopDrag);
                };

                document.addEventListener('mousemove', drag);
                document.addEventListener('mouseup', stopDrag);
            }

            initializeApps() {
                this.apps = {
                    fileManager: new FileManagerApp(this),
                    textEditor: new TextEditorApp(this),
                    calculator: new CalculatorApp(this),
                    settings: new SettingsApp(this),
                    terminal: new TerminalApp(this),
                    browser: new BrowserApp(this)
                };
            }

            openApp(appName) {
                if (this.apps[appName]) {
                    this.apps[appName].open();
                }
            }

            logout() {
                this.currentUser = null;
                this.windows.forEach(windowId => this.closeWindow(windowId));
                document.getElementById('desktop').classList.add('hidden');
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
            }
        }

        // Virtual File System
        class VirtualFileSystem {
            constructor() {
                this.files = {
                    '/': { type: 'directory', children: {} },
                    '/system': { type: 'directory', children: {} },
                    '/user': { type: 'directory', children: {} },
                    '/user/documents': { type: 'directory', children: {} },
                    '/user/desktop': { type: 'directory', children: {} },
                    '/user/downloads': { type: 'directory', children: {} }
                };
                this.loadFromStorage();
            }

            normalizePath(path) {
                return path.replace(/\/+/g, '/').replace(/\/$/, '') || '/';
            }

            writeFile(path, content) {
                path = this.normalizePath(path);
                const parts = path.split('/').filter(p => p);
                let current = this.files['/'];

                // Create directories if they don't exist
                for (let i = 0; i < parts.length - 1; i++) {
                    const part = parts[i];
                    if (!current.children[part]) {
                        current.children[part] = { type: 'directory', children: {} };
                    }
                    current = current.children[part];
                }

                // Create file
                const fileName = parts[parts.length - 1];
                current.children[fileName] = {
                    type: 'file',
                    content: content,
                    modified: new Date().toISOString()
                };

                this.saveToStorage();
            }

            readFile(path) {
                path = this.normalizePath(path);
                const file = this.getFileObject(path);
                return file && file.type === 'file' ? file.content : null;
            }

            deleteFile(path) {
                path = this.normalizePath(path);
                const parts = path.split('/').filter(p => p);
                let current = this.files['/'];

                for (let i = 0; i < parts.length - 1; i++) {
                    const part = parts[i];
                    if (!current.children[part]) return false;
                    current = current.children[part];
                }

                const fileName = parts[parts.length - 1];
                if (current.children[fileName]) {
                    delete current.children[fileName];
                    this.saveToStorage();
                    return true;
                }
                return false;
            }

            listDirectory(path) {
                path = this.normalizePath(path);
                const dir = this.getFileObject(path);
                if (dir && dir.type === 'directory') {
                    return Object.keys(dir.children).map(name => ({
                        name,
                        type: dir.children[name].type,
                        modified: dir.children[name].modified || new Date().toISOString()
                    }));
                }
                return [];
            }

            getFileObject(path) {
                path = this.normalizePath(path);
                if (path === '/') return this.files['/'];

                const parts = path.split('/').filter(p => p);
                let current = this.files['/'];

                for (const part of parts) {
                    if (!current.children || !current.children[part]) {
                        return null;
                    }
                    current = current.children[part];
                }

                return current;
            }

            saveToStorage() {
                // In a real implementation, this would save to a more persistent storage
                // For this demo, we'll keep it in memory
            }

            loadFromStorage() {
                // Load from persistent storage
            }
        }

        // Base App Class
        class BaseApp {
            constructor(os) {
                this.os = os;
                this.windowId = null;
            }

            open() {
                if (this.windowId && document.getElementById(this.windowId)) {
                    this.os.bringToFront(this.windowId);
                    return;
                }
                this.windowId = this.os.createWindow(this.title, this.getContent(), this.width, this.height);
                this.onOpen();
            }

            onOpen() {
                // Override in subclasses
            }

            getContent() {
                return '<div>Base App Content</div>';
            }
        }

        // File Manager App
        class FileManagerApp extends BaseApp {
            constructor(os) {
                super(os);
                this.title = 'File Manager';
                this.width = 800;
                this.height = 600;
                this.currentPath = '/user';
            }

            getContent() {
                return `
                    <div class="file-manager">
                        <div class="file-sidebar">
                            <h3>Quick Access</h3>
                            <div onclick="webOS.apps.fileManager.navigateTo('/user/desktop')" style="padding: 8px; cursor: pointer;">Desktop</div>
                            <div onclick="webOS.apps.fileManager.navigateTo('/user/documents')" style="padding: 8px; cursor: pointer;">Documents</div>
                            <div onclick="webOS.apps.fileManager.navigateTo('/user/downloads')" style="padding: 8px; cursor: pointer;">Downloads</div>
                        </div>
                        <div class="file-content">
                            <div class="file-toolbar">
                                <button onclick="webOS.apps.fileManager.goBack()">← Back</button>
                                <button onclick="webOS.apps.fileManager.goUp()">↑ Up</button>
                                <button onclick="webOS.apps.fileManager.refresh()">🔄 Refresh</button>
                                <button onclick="webOS.apps.fileManager.newFolder()">📁 New Folder</button>
                                <button onclick="webOS.apps.fileManager.newFile()">📄 New File</button>
                            </div>
                            <div style="margin-bottom: 16px; font-size: 14px; color: #666;">
                                Current: <span id="currentPath">${this.currentPath}</span>
                            </div>
                            <div class="file-grid" id="fileGrid">
                                ${this.renderFiles()}
                            </div>
                        </div>
                    </div>
                `;
            }

            renderFiles() {
                const files = this.os.fileSystem.listDirectory(this.currentPath);
                return files.map(file => `
                    <div class="file-item" ondblclick="webOS.apps.fileManager.openFile('${file.name}', '${file.type}')">
                        <div class="file-icon">${file.type === 'directory' ? '📁' : '📄'}</div>
                        <div style="font-size: 12px; word-break: break-word;">${file.name}</div>
                    </div>
                `).join('');
            }

            navigateTo(path) {
                this.currentPath = path;
                this.refresh();
            }

            refresh() {
                const fileGrid = document.getElementById('fileGrid');
                const currentPathEl = document.getElementById('currentPath');
                if (fileGrid) {
                    fileGrid.innerHTML = this.renderFiles();
                }
                if (currentPathEl) {
                    currentPathEl.textContent = this.currentPath;
                }
            }

            goUp() {
                if (this.currentPath !== '/') {
                    const parts = this.currentPath.split('/');
                    parts.pop();
                    this.currentPath = parts.join('/') || '/';
                    this.refresh();
                }
            }

            goBack() {
                // Simple implementation - in a real app, this would maintain history
                this.goUp();
            }

            openFile(name, type) {
                if (type === 'directory') {
                    this.currentPath = `${this.currentPath}/${name}`.replace(/\/+/g, '/');
                    this.refresh();
                } else {
                    const content = this.os.fileSystem.readFile(`${this.currentPath}/${name}`);
                    this.os.apps.textEditor.openFile(name, content);
                }
            }

            newFolder() {
                const name = prompt('Enter folder name:');
                if (name) {
                    // Create directory in file system
                    const path = `${this.currentPath}/${name}`;
                    this.os.fileSystem.writeFile(`${path}/.keep`, '');
                    this.refresh();
                }
            }

            newFile() {
                const name = prompt('Enter file name:');
                if (name) {
                    const path = `${this.currentPath}/${name}`;
                    this.os.fileSystem.writeFile(path, '');
                    this.refresh();
                }
            }
        }

        // Text Editor App
        class TextEditorApp extends BaseApp {
            constructor(os) {
                super(os);
                this.title = 'Text Editor';
                this.width = 700;
                this.height = 500;
                this.currentFile = null;
            }

            getContent() {
                return `
                    <div style="display: flex; flex-direction: column; height: 100%;">
                                                <div style="border-bottom: 1px solid var(--border-color); padding: 8px;">
                            <button onclick="webOS.apps.textEditor.saveFile()">💾 Save</button>
                            <button onclick="webOS.apps.textEditor.openFile()">📂 Open</button>
                            <button onclick="webOS.apps.textEditor.newFile()">📄 New</button>
                            <span id="currentFileName" style="margin-left: 16px; font-weight: bold;">Untitled</span>
                        </div>
                        <textarea id="textEditorContent" style="flex: 1; border: none; outline: none; padding: 16px; font-family: monospace; resize: none;" placeholder="Start typing..."></textarea>
                    </div>
                `;
            }

            openFile(filename, content) {
                this.open();
                setTimeout(() => {
                    const textarea = document.getElementById('textEditorContent');
                    const filenameEl = document.getElementById('currentFileName');
                    if (textarea && content !== null) {
                        textarea.value = content;
                    }
                    if (filenameEl && filename) {
                        filenameEl.textContent = filename;
                        this.currentFile = filename;
                    }
                }, 100);
            }

            saveFile() {
                const content = document.getElementById('textEditorContent')?.value || '';
                let filename = this.currentFile;
                
                if (!filename) {
                    filename = prompt('Enter filename:');
                    if (!filename) return;
                }
                
                this.os.fileSystem.writeFile(`/user/documents/${filename}`, content);
                this.currentFile = filename;
                document.getElementById('currentFileName').textContent = filename;
                alert('File saved successfully!');
            }

            newFile() {
                const textarea = document.getElementById('textEditorContent');
                const filenameEl = document.getElementById('currentFileName');
                if (textarea) textarea.value = '';
                if (filenameEl) filenameEl.textContent = 'Untitled';
                this.currentFile = null;
            }
        }

        // Calculator App
        class CalculatorApp extends BaseApp {
            constructor(os) {
                super(os);
                this.title = 'Calculator';
                this.width = 300;
                this.height = 400;
                this.display = '0';
                this.previousValue = null;
                this.operation = null;
                this.waitingForNewValue = false;
            }

            getContent() {
                return `
                    <div style="display: flex; flex-direction: column; height: 100%; background: #f0f0f0;">
                        <div id="calcDisplay" style="background: black; color: lime; padding: 20px; font-size: 24px; font-family: monospace; text-align: right; min-height: 60px; display: flex; align-items: center; justify-content: flex-end;">0</div>
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1px; flex: 1;">
                            <button onclick="webOS.apps.calculator.clear()" style="background: #ff6b6b; color: white; border: none; font-size: 18px; cursor: pointer;">C</button>
                            <button onclick="webOS.apps.calculator.clearEntry()" style="background: #feca57; color: white; border: none; font-size: 18px; cursor: pointer;">CE</button>
                            <button onclick="webOS.apps.calculator.inputOperation('/')" style="background: #48dbfb; color: white; border: none; font-size: 18px; cursor: pointer;">÷</button>
                            <button onclick="webOS.apps.calculator.inputOperation('*')" style="background: #48dbfb; color: white; border: none; font-size: 18px; cursor: pointer;">×</button>
                            
                            <button onclick="webOS.apps.calculator.inputNumber('7')" style="background: white; border: none; font-size: 18px; cursor: pointer;">7</button>
                            <button onclick="webOS.apps.calculator.inputNumber('8')" style="background: white; border: none; font-size: 18px; cursor: pointer;">8</button>
                            <button onclick="webOS.apps.calculator.inputNumber('9')" style="background: white; border: none; font-size: 18px; cursor: pointer;">9</button>
                            <button onclick="webOS.apps.calculator.inputOperation('-')" style="background: #48dbfb; color: white; border: none; font-size: 18px; cursor: pointer;">-</button>
                            
                            <button onclick="webOS.apps.calculator.inputNumber('4')" style="background: white; border: none; font-size: 18px; cursor: pointer;">4</button>
                            <button onclick="webOS.apps.calculator.inputNumber('5')" style="background: white; border: none; font-size: 18px; cursor: pointer;">5</button>
                            <button onclick="webOS.apps.calculator.inputNumber('6')" style="background: white; border: none; font-size: 18px; cursor: pointer;">6</button>
                            <button onclick="webOS.apps.calculator.inputOperation('+')" style="background: #48dbfb; color: white; border: none; font-size: 18px; cursor: pointer;">+</button>
                            
                            <button onclick="webOS.apps.calculator.inputNumber('1')" style="background: white; border: none; font-size: 18px; cursor: pointer;">1</button>
                            <button onclick="webOS.apps.calculator.inputNumber('2')" style="background: white; border: none; font-size: 18px; cursor: pointer;">2</button>
                            <button onclick="webOS.apps.calculator.inputNumber('3')" style="background: white; border: none; font-size: 18px; cursor: pointer;">3</button>
                            <button onclick="webOS.apps.calculator.calculate()" style="background: #ff9ff3; color: white; border: none; font-size: 18px; cursor: pointer; grid-row: span 2;">=</button>
                            
                            <button onclick="webOS.apps.calculator.inputNumber('0')" style="background: white; border: none; font-size: 18px; cursor: pointer; grid-column: span 2;">0</button>
                            <button onclick="webOS.apps.calculator.inputNumber('.')" style="background: white; border: none; font-size: 18px; cursor: pointer;">.</button>
                        </div>
                    </div>
                `;
            }

            updateDisplay() {
                const displayEl = document.getElementById('calcDisplay');
                if (displayEl) {
                    displayEl.textContent = this.display;
                }
            }

            inputNumber(num) {
                if (this.waitingForNewValue) {
                    this.display = num;
                    this.waitingForNewValue = false;
                } else {
                    this.display = this.display === '0' ? num : this.display + num;
                }
                this.updateDisplay();
            }

            inputOperation(nextOperation) {
                const inputValue = parseFloat(this.display);

                if (this.previousValue === null) {
                    this.previousValue = inputValue;
                } else if (this.operation) {
                    const currentValue = this.previousValue || 0;
                    const newValue = this.performCalculation();

                    this.display = String(newValue);
                    this.previousValue = newValue;
                    this.updateDisplay();
                }

                this.waitingForNewValue = true;
                this.operation = nextOperation;
            }

            performCalculation() {
                const prev = this.previousValue;
                const current = parseFloat(this.display);

                switch (this.operation) {
                    case '+': return prev + current;
                    case '-': return prev - current;
                    case '*': return prev * current;
                    case '/': return current !== 0 ? prev / current : 0;
                    default: return current;
                }
            }

            calculate() {
                const inputValue = parseFloat(this.display);

                if (this.previousValue !== null && this.operation) {
                    this.display = String(this.performCalculation());
                    this.previousValue = null;
                    this.operation = null;
                    this.waitingForNewValue = true;
                    this.updateDisplay();
                }
            }

            clear() {
                this.display = '0';
                this.previousValue = null;
                this.operation = null;
                this.waitingForNewValue = false;
                this.updateDisplay();
            }

            clearEntry() {
                this.display = '0';
                this.updateDisplay();
            }
        }

        // Settings App
        class SettingsApp extends BaseApp {
            constructor(os) {
                super(os);
                this.title = 'Settings';
                this.width = 600;
                this.height = 500;
            }

            getContent() {
                return `
                    <div style="display: flex; height: 100%;">
                        <div class="settings-nav">
                            <div onclick="webOS.apps.settings.showSection('appearance')" style="padding: 12px; cursor: pointer; border-radius: 6px; margin-bottom: 4px;" id="nav-appearance">Appearance</div>
                            <div onclick="webOS.apps.settings.showSection('system')" style="padding: 12px; cursor: pointer; border-radius: 6px; margin-bottom: 4px;" id="nav-system">System</div>
                            <div onclick="webOS.apps.settings.showSection('accounts')" style="padding: 12px; cursor: pointer; border-radius: 6px; margin-bottom: 4px;" id="nav-accounts">Accounts</div>
                        </div>
                        <div class="settings-content" id="settingsContent">
                            ${this.getAppearanceSection()}
                        </div>
                    </div>
                `;
            }

            showSection(section) {
                const content = document.getElementById('settingsContent');
                // Clear active nav
                document.querySelectorAll('.settings-nav > div').forEach(el => {
                    el.style.background = 'transparent';
                });
                
                // Set active nav
                document.getElementById('nav-' + section).style.background = 'var(--primary-color)';
                document.getElementById('nav-' + section).style.color = 'white';

                switch (section) {
                    case 'appearance':
                        content.innerHTML = this.getAppearanceSection();
                        break;
                    case 'system':
                        content.innerHTML = this.getSystemSection();
                        break;
                    case 'accounts':
                        content.innerHTML = this.getAccountsSection();
                        break;
                }
            }

            getAppearanceSection() {
                return `
                    <h2>Appearance</h2>
                    <div class="settings-section">
                        <h3>Theme</h3>
                        <div class="setting-item">
                            <span>Wallpaper</span>
                            <select onchange="webOS.apps.settings.changeWallpaper(this.value)">
                                <option value="linear-gradient(135deg, #667eea 0%, #764ba2 100%)">Default Blue</option>
                                <option value="linear-gradient(135deg, #f093fb 0%, #f5576c 100%)">Pink Sunset</option>
                                <option value="linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)">Ocean Blue</option>
                                <option value="linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)">Green Mint</option>
                                <option value="linear-gradient(135deg, #fa709a 0%, #fee140 100%)">Warm Sunset</option>
                            </select>
                        </div>
                    </div>
                `;
            }

            getSystemSection() {
                return `
                    <h2>System Information</h2>
                    <div class="settings-section">
                        <div class="setting-item">
                            <span>WebOS Version</span>
                            <span>1.0.0</span>
                        </div>
                        <div class="setting-item">
                            <span>Browser</span>
                            <span>${navigator.userAgent.split(' ')[0]}</span>
                        </div>
                        <div class="setting-item">
                            <span>Screen Resolution</span>
                            <span>${screen.width}×${screen.height}</span>
                        </div>
                        <div class="setting-item">
                            <span>Available Storage</span>
                            <span>Unlimited (Virtual)</span>
                        </div>
                    </div>
                `;
            }

            getAccountsSection() {
                return `
                    <h2>User Accounts</h2>
                    <div class="settings-section">
                        <div class="setting-item">
                            <span>Current User</span>
                            <span>${webOS.currentUser}</span>
                        </div>
                        <div class="setting-item">
                            <span>Account Type</span>
                            <span>Administrator</span>
                        </div>
                        <button onclick="webOS.logout()" style="margin-top: 16px; padding: 8px 16px; background: var(--primary-color); color: white; border: none; border-radius: 6px; cursor: pointer;">Sign Out</button>
                    </div>
                `;
            }

            changeWallpaper(wallpaper) {
                webOS.config.wallpaper = wallpaper;
                webOS.applyTheme();
                webOS.saveConfig();
            }
        }

        // Terminal App
        class TerminalApp extends BaseApp {
            constructor(os) {
                super(os);
                this.title = 'Terminal';
                this.width = 600;
                this.height = 400;
                this.history = [];
                this.historyIndex = -1;
                this.currentPath = '/user';
            }

            getContent() {
                return `
                    <div style="background: black; color: lime; font-family: monospace; height: 100%; display: flex; flex-direction: column;">
                        <div id="terminalOutput" style="flex: 1; padding: 16px; overflow-y: auto; white-space: pre-wrap;">WebOS Terminal v1.0.0
Type 'help' for available commands.

</div>
                        <div style="display: flex; align-items: center; padding: 8px 16px; border-top: 1px solid #333;">
                            <span id="terminalPrompt">${webOS.currentUser}@webos:${this.currentPath}$ </span>
                            <input type="text" id="terminalInput" style="flex: 1; background: transparent; border: none; color: lime; font-family: monospace; outline: none; margin-left: 8px;" onkeydown="webOS.apps.terminal.handleInput(event)">
                        </div>
                    </div>
                `;
            }

            onOpen() {
                setTimeout(() => {
                    document.getElementById('terminalInput')?.focus();
                }, 100);
            }

            handleInput(event) {
                if (event.key === 'Enter') {
                    const input = event.target.value;
                    this.executeCommand(input);
                    event.target.value = '';
                } else if (event.key === 'ArrowUp') {
                    if (this.historyIndex < this.history.length - 1) {
                        this.historyIndex++;
                        event.target.value = this.history[this.history.length - 1 - this.historyIndex] || '';
                    }
                } else if (event.key === 'ArrowDown') {
                    if (this.historyIndex > -1) {
                        this.historyIndex--;
                        event.target.value = this.historyIndex === -1 ? '' : this.history[this.history.length - 1 - this.historyIndex];
                    }
                }
            }

            executeCommand(command) {
                const output = document.getElementById('terminalOutput');
                const prompt = document.getElementById('terminalPrompt');
                
                // Add command to history
                if (command.trim()) {
                    this.history.push(command);
                    this.historyIndex = -1;
                }

                // Display command
                output.textContent += `${webOS.currentUser}@webos:${this.currentPath}$ ${command}\n`;

                const parts = command.trim().split(' ');
                const cmd = parts[0];
                const args = parts.slice(1);

                switch (cmd) {
                    case 'help':
                        output.textContent += `Available commands:
  help - Show this help message
  ls - List directory contents
  cd <dir> - Change directory
  pwd - Print working directory
  cat <file> - Display file contents
  touch <file> - Create empty file
  mkdir <dir> - Create directory
  rm <file> - Remove file
  clear - Clear terminal
  whoami - Show current user
  date - Show current date/time
  echo <text> - Display text
  calc <expression> - Simple calculator

`;
                        break;
                    
                    case 'ls':
                        const files = webOS.fileSystem.listDirectory(this.currentPath);
                        files.forEach(file => {
                            output.textContent += `${file.type === 'directory' ? 'd' : '-'}  ${file.name}\n`;
                        });
                        break;
                        
                    case 'pwd':
                        output.textContent += `${this.currentPath}\n`;
                        break;
                        
                    case 'cd':
                        if (args[0]) {
                            let newPath = args[0];
                            if (!newPath.startsWith('/')) {
                                newPath = `${this.currentPath}/${newPath}`.replace(/\/+/g, '/');
                            }
                            if (webOS.fileSystem.getFileObject(newPath)?.type === 'directory') {
                                this.currentPath = newPath;
                                prompt.textContent = `${webOS.currentUser}@webos:${this.currentPath}$ `;
                            } else {
                                output.textContent += `cd: ${newPath}: No such directory\n`;
                            }
                        }
                        break;
                        
                    case 'cat':
                        if (args[0]) {
                            const filePath = args[0].startsWith('/') ? args[0] : `${this.currentPath}/${args[0]}`;
                            const content = webOS.fileSystem.readFile(filePath);
                            if (content !== null) {
                                output.textContent += `${content}\n`;
                            } else {
                                output.textContent += `cat: ${args[0]}: No such file\n`;
                            }
                        }
                        break;
                        
                    case 'clear':
                        output.textContent = '';
                        break;
                        
                    case 'whoami':
                        output.textContent += `${webOS.currentUser}\n`;
                        break;
                        
                    case 'date':
                        output.textContent += `${new Date().toString()}\n`;
                        break;
                        
                    case 'echo':
                        output.textContent += `${args.join(' ')}\n`;
                        break;
                        
                    case 'calc':
                        try {
                            const result = eval(args.join(' '));
                            output.textContent += `${result}\n`;
                        } catch (e) {
                            output.textContent += `calc: Invalid expression\n`;
                        }
                        break;
                        
                    default:
                        if (cmd) {
                            output.textContent += `${cmd}: command not found\n`;
                        }
                        break;
                }

                output.scrollTop = output.scrollHeight;
            }
        }

        // Browser App
        class BrowserApp extends BaseApp {
            constructor(os) {
                super(os);
                this.title = 'Web Browser';
                this.width = 800;
                this.height = 600;
                this.currentUrl = 'about:home';
            }

            getContent() {
                return `
                    <div style="display: flex; flex-direction: column; height: 100%;">
                        <div style="display: flex; align-items: center; padding: 8px; border-bottom: 1px solid var(--border-color); gap: 8px;">
                            <button onclick="webOS.apps.browser.goBack()" style="padding: 4px 8px; border: 1px solid var(--border-color); background: white; border-radius: 4px; cursor: pointer;">←</button>
                            <button onclick="webOS.apps.browser.goForward()" style="padding: 4px 8px; border: 1px solid var(--border-color); background: white; border-radius: 4px; cursor: pointer;">→</button>
                            <button onclick="webOS.apps.browser.refresh()" style="padding: 4px 8px; border: 1px solid var(--border-color); background: white; border-radius: 4px; cursor: pointer;">🔄</button>
                            <input type="text" id="browserUrl" value="${this.currentUrl}" onkeydown="if(event.key==='Enter') webOS.apps.browser.navigate(this.value)" style="flex: 1; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px;">
                            <button onclick="webOS.apps.browser.navigate(document.getElementById('browserUrl').value)" style="padding: 8px 12px; background: var(--primary-color); color: white; border: none; border-radius: 4px; cursor: pointer;">Go</button>
                        </div>
                        <div id="browserContent" style="flex: 1; padding: 20px; overflow: auto;">
                            ${this.getHomePage()}
                        </div>
                    </div>
                `;
            }

            getHomePage() {
                return `
                    <div style="text-align: center; padding: 40px;">
                        <h1 style="color: var(--primary-color); margin-bottom: 20px;">WebOS Browser</h1>
                        <p style="margin-bottom: 30px; color: #666;">Your gateway to the web</p>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 40px;">
                            <div onclick="webOS.apps.browser.navigate('https://google.com')" style="padding: 20px; border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                <h3 style="color: var(--primary-color);">🔍 Google</h3>
                                <p style="color: #666; font-size: 14px;">Search the web</p>
                            </div>
                            <div onclick="webOS.apps.browser.navigate('https://github.com')" style="padding: 20px; border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                <h3 style="color: var(--primary-color);">💻 GitHub</h3>
                                <p style="color: #666; font-size: 14px;">Code repository</p>
                            </div>
                            <div onclick="webOS.apps.browser.navigate('https://news.ycombinator.com')" style="padding: 20px; border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                <h3 style="color: var(--primary-color);">📰 Hacker News</h3>
                                <p style="color: #666; font-size: 14px;">Tech news</p>
                            </div>
                            <div onclick="webOS.apps.browser.navigate('https://stackoverflow.com')" style="padding: 20px; border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                <h3 style="color: var(--primary-color);">❓ Stack Overflow</h3>
                                <p style="color: #666; font-size: 14px;">Developer Q&A</p>
                            </div>
                        </div>
                    </div>
                `;
            }

            navigate(url) {
                this.currentUrl = url;
                const content = document.getElementById('browserContent');
                const urlInput = document.getElementById('browserUrl');
                
                if (urlInput) urlInput.value = url;
                
                if (url === 'about:home') {
                    content.innerHTML = this.getHomePage();
                } else {
                    // In a real browser, this would load the actual page
                    // For this demo, we'll show a placeholder
                    content.innerHTML = `
                        <div style="text-align: center; padding: 40px;">
                            <h2>🌐 External Site</h2>
                            <p>In a real implementation, this would navigate to:</p>
                            <p style="font-family: monospace; background: #f0f0f0; padding: 10px; border-radius: 4px; margin: 20px 0;">${url}</p>
                            <p style="color: #666; font-size: 14px; margin-top: 20px;">This is a demo WebOS browser. External navigation is simulated.</p>
                            <button onclick="webOS.apps.browser.navigate('about:home')" style="margin-top: 20px; padding: 10px 20px; background: var(--primary-color); color: white; border: none; border-radius: 4px; cursor: pointer;">← Back to Home</button>
                        </div>
                    `;
                }
            }

            goBack() {
                // Simple implementation - in a real browser, this would maintain history
                this.navigate('about:home');
            }

            goForward() {
                // Placeholder for forward navigation
            }

            refresh() {
                this.navigate(this.currentUrl);
            }
        }

        // Initialize WebOS when page loads
        document.addEventListener('DOMContentLoaded', function() {
            webOS = new WebOS();
            
            // Hide start menu when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.start-menu') && !e.target.closest('.start-button')) {
                    document.getElementById('startMenu').classList.remove('active');
                }
            });
            
            // Create some default files
            webOS.fileSystem.writeFile('/user/documents/welcome.txt', 'Welcome to WebOS!\n\nThis is a fully functional web-based operating system with:\n- File management\n- Text editing\n- Calculator\n- Terminal\n- Web browser\n- System settings\n\nEnjoy exploring!');
            webOS.fileSystem.writeFile('/user/documents/readme.md', '# WebOS\n\nA complete operating system built with web technologies.\n\n## Features\n- Virtual file system\n- Window management\n- Application sandboxing\n- Modular architecture\n- Extensible plugin system');
        });
    </script>